name: Build InfiniTime Firmware

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            cmake \
            ninja-build \
            git \
            curl \
            unzip \
            gcc-arm-none-eabi \
            libnewlib-arm-none-eabi

      - name: Download nRF5 SDK 17.1.0
        run: |
          set -euxo pipefail
if [ ! -d "nrf5_sdk" ]; then
  echo "Downloading nRF5 SDK 17.1.0..."
  curl -L https://codeload.github.com/NordicSemiconductor/nRF5_SDK/zip/refs/tags/v17.1.0 -o nrf5_sdk.zip
  unzip -q nrf5_sdk.zip
  mv nRF5_SDK-17.1.0 nrf5_sdk
fi




      - name: Configure CMake
        run: |
          mkdir -p build
          cd build
          cmake .. \
            -GNinja \
            -DARM_NONE_EABI_TOOLCHAIN_PATH=/usr \
            -DNRF5_SDK_PATH=$GITHUB_WORKSPACE/nrf5_sdk

      - name: Build firmware
        run: |
          cd build
          ninja
